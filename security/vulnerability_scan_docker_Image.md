# Scan Docker image for vulnerabilities

A script for scanning vulnerabilities of a Docker image.

~~~sh
# Scan Docker image for vulnerabilities
# These commands create SBOM of a Docker image and a vulnerability report
# Tools used: syft, grype

# Files with similar names to the ones below are output
# docker-image_1.0.1_sbom_syftjson_2025-04-17_12-47.json
# docker-image_1.0.1_sbom_table_2025-04-17_12-47.txt
# docker-image_1.0.1_vuln_2025-04-17_12-47.sarif

# Variables
date=$(date +"%Y-%m-%d_%H-%M")
image="docker-image"
version="1.0.1"
image_url="docker.registry.com/$version/$image:latest"

dir="security_scan_"$image"_"$version"_"$date"

# Check if we're currently in "dir"
# or create "dir" if it doesn't exist
# cd into "dir"
if [ $(basename $(pwd)) == "$dir" ]; then
  echo ""
elif [ ! -d "$dir" ]; then
  mkdir $dir
  cd $dir
else
  cd $dir
fi

# Create SBOM as syftjson format, which can be converted to other formats
syft "$image_url" -o syft-json > "$image"_"$version"_sbom_syftjson_"$date".json

# Convert syftjson SBOM to a human-readable table
syft convert "$image"_"$version"_sbom_syftjson_"$date".json -o table="$image"_"$version"_sbom_table_"$date".txt

# Create vulnerability report with grype
grype sbom:./"$image"_"$version"_sbom_syftjson_"$date".json -o sarif > "$image"_"$version"_vuln_"$date".sarif
~~~
